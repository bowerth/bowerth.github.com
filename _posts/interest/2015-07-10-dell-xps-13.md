---
layout   : post
category : interest
tagline  :
tags     :
---
{% include JB/setup %}

## Issues

- [github: advancingu: XPS13 Linux Issues](https://github.com/advancingu/XPS13Linux/issues)

## BIOS update

### [XPS 9343 Drivers](http://www.dell.com/support/home/us/en/04/product-support/product/xps-13-9343-laptop/drivers)

- [A07 BIOS update](http://downloads.dell.com/FOLDER03418376M/1/9343_BIOS_Rev_A07.exe)

```
cd ~/Downloads
wget http://downloads.dell.com/FOLDER03418376M/1/9343_BIOS_Rev_A07.exe
sudo cp 9343_BIOS_Rev_A07.exe /boot/efi/
```

- restart
- press `F12` when booting and select `BIOS update`

### Sound card

- [archlinux wiki: Dell XPS 13 (2015)](https://wiki.archlinux.org/index.php/Dell_XPS_13_%282015%29)
- [bbs.archlinux.org: Dell XPS 13 2015 A02 bios broken sound after kernel upgrade to 4.4.1-2](https://bbs.archlinux.org/viewtopic.php?id=208461)
- [amixer](http://linuxcommand.org/man_pages/amixer1.html)

get help for amixer
:   `$ man amixer`

show controls
:   `$ amixer controls`

get `SPO` parameter
:   `$ amixer -c 1 get 'SPO'`

set `SPO` parameter
:   `$ amixer -c 1 set 'SPO' on`

install `pavucontrol
:   `$ sudo dnf install -y pavucontrol` and run `$ pavucontrol`

#### ALSA configuration

By default, ALSA doesn't output sound to the PCH card but to the HDMI card. This can be changed by following ALSA#Set the default sound card. In the current case, both cards use the snd_hda_intel module. To set the proper order, create the following .conf file in /etc/modprobe.d/: `/etc/modprobe.d/alsa-base.conf` with contents 

```
options snd_hda_intel index=1,0
```

manual configuration
:   `$ alsamixer` then press `F6` and select `1 HDA Intel PCH` or `broadwell-rt286`  
	press `F4` to configure capture: on `Mic` press `Space` to activate capture

check configuration
:   `$ aplay -l`

### Kernel 4.3 to 4.4

- CONFIG_ACPI_REV_OVERRIDE_POSSIBLE [bbs.archlinux.org: XPS 13 9343 sound issue](https://bbs.archlinux.org/viewtopic.php?id=208674)
- [wiki.archlinux.org: Dell XPS13 (2015): Audio](https://wiki.archlinux.org/index.php/Dell_XPS_13_(2015)#Audio)
- [ask.fedoraproject.org: No sound with kernel 4.4](https://ask.fedoraproject.org/en/question/83547/no-sound-with-kernel-44/)

print kernel version
:   `$ uname -r`  
    `4.4.3-300.fc23.x86_64`

print soundcards
:   `$ cat /proc/asound/cards`

To prevent the silliness with the broken kernel 4.4 upgrade from bothering you each time you do an update, follow these steps:

- make sure you have at least two kernels installed; by default dnf should keep the last 3 kernel versions around, but to make sure: `$ sudo dnf install kernel-4.3.5-300.fc23.x86_64`
- reboot into kernel 4.3 by changing the kernel version during boot

list installed kernels
:   `$ rpm -qa kernel`  
	`kernel-4.4.2-301.fc23.x86_64`  
	`kernel-4.3.5-300.fc23.x86_64`

list installed `kernel` packages
:   `$ sudo dnf list kernel*`

remove kernel 4.4.2-301
:   `$ sudo dnf remove kernel-devel-4.4.2-301.fc23.x86_64`  
    `$ sudo rpm -e kernel-4.4.2-301.fc23.x86_64`  
    `$ sudo dnf remove kernel-modules-4.4.2-301.fc23.x86_64`  
    `$ sudo dnf remove kernel-core-4.4.2-301.fc23.x86_64`

remove kernel 4.4.3-300
:   `$ sudo dnf remove kernel-4.4.3-300.fc23.x86_64`  
    `$ sudo dnf remove kernel-modules-4.4.3-300.fc23.x86_64`
    `$ sudo dnf remove kernel-core-4.4.3-300.fc23.x86_64`
    `$ sudo dnf remove kernel-devel-4.4.3-300.fc23.x86_64`
	this attempts to remove 293 packages (443 M) `$ sudo dnf remove kernel-headers-4.4.3-300.fc23.x86_64`

install the versionlock dnf plugin
:   `$ sudo dnf install python-dnf-plugins-extras-versionlock.noarch`  
    `$ sudo dnf install python3-dnf-plugins-extras-versionlock.noarch`

lock the kernel to 4.3
:   `$ sudo dnf versionlock kernel-4.3.5-300.fc23.x86_64`  
    `$ sudo dnf versionlock kernel-modules-4.3.5-300.fc23.x86_64`  
    `$ sudo dnf versionlock kernel-core-4.3.5-300.fc23.x86_64`
    `$ sudo dnf versionlock kernel-devel-4.3.5-300.fc23.x86_64`
    lock on `headers` not activated `$ sudo dnf versionlock kernel-headers-4.3.5-300.fc23.x86_64`

- cold start twice (ie. turn the machine completely off twice) to get the previous sound behavior.

The versionlock will prevent the kernel from being updated during normal updates.

list existing versionlocks
:   `$ sudo dnf versionlock list`

remove the versionlock
:    `$ sudo dnf versionlock clear`

synopsis
:   `$ dnf versionlock [add|exclude|list|delete|clear] [<package-spec>]`

#### remove custom entries from `/boot` and update GRUB configuration

- [fedoraproject.org: GRUB 2](https://fedoraproject.org/wiki/GRUB_2?rd=Grub2)

remove all files containing `4.4.2-301` (config-..., initramfs-..., System.map-... vmlinuz-...)
:   `$ cd /boot; ls | grep 4.4.2-301`  
	`$ sudo rm -fr $(ls|grep 4.4.2-301)`

- `/boot/efi/EFI/fedora/grub.cfg` automatically generated by grub2-mkconfig using templates from `/etc/grub.d` and settings from `/etc/default/grub`

update `grub.cfg`
:   `$ sudo grub2-mkconfig -o /boot/grub2/grub.cfg`
	on UEFI `$ grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg`

### Wifi card

- [Linux Wireless: b43](https://wireless.wiki.kernel.org/en/users/Drivers/b43)

- follow tutorial [How to get Wifi working on Dell XPS 13 for Fedora](https://doughgle.wordpress.com/2015/03/29/how-to-get-wifi-working-on-dell-xps-13-9343-model-for-fedora-linux/)

`$ lspci -k`
:   Network controller: Broadcom Corporation BCM4352 802.11ac Wireless Network Adapter (rev 03)

check drivers that interfere with `wl`
:   `$ lsmod | egrep 'bcm|brc|b43|ndis'` and  
    `$ egrep 'bcm|brc|b43|ndis' /etc/modprobe.d/*`  

install `kernel-modules`
:   `$ sudo dnf install kernel-modules` 

- reboot
- after system update (`sudo dnf update`), install `akmods` and `akmod-wl`
- `sudo akmods`
- `sudo depmod -a` (if wl Module cannot be found)
- `sudo modprobe wl`
- reboot

## Accessories

- [Dell: Docking Station](http://accessories.us.dell.com/sna/productdetail.aspx?sku=452-BBPG&ref=meekosystems)
- [Dell UltraSharp U3415W - 34" IPS Écran LCD](http://pilot.search.dell.com/U3415W)
- [Dell UltraSharp U2913WM 73.7 cm (29”)](http://www.dell.com/ed/business/p/dell-u2913wm/pd)
- [Dell Single Monitor Arm Stand - MSA14](http://pilot.search.dell.com/msa14)
- [displaylink.com: universal docking stations](http://www.displaylink.com/products/universal-docking-stations)
- [LaCie](http://www.amazon.fr/s/ref=nb_sb_noss?__mk_fr_FR=%C3%85M%C3%85%C5%BD%C3%95%C3%91&url=node%3D430415031&field-keywords=la+cie)
- [Sennheiser SP 20 ML Speakerphone](http://www.amazon.fr/Sennheiser-TW9094-Sp-20-Speakerphone/dp/B00K2RQ94C)

### Lenovo LT1421

- [support.lenovo.com: ThinkVision LT1421 14"](https://support.lenovo.com/fr/fr/documents/pd015702)
- [displaylink.org: forum: Linux and Open Source](http://www.displaylink.org/forum/forumdisplay.php?f=29)
- [displaylink.com: Ubuntu Driver Download](http://www.displaylink.com/downloads/ubuntu)
- [github: DisplayLink: evdi Extensible Virtual Display Interface](https://github.com/DisplayLink/evdi)
- [support.displaylink.com: Porting the DisplayLink Ubuntu driver to other Linux distributions](http://support.displaylink.com/knowledgebase/articles/679060)
- [nothen.com.ar: Fedora support for DisplayLink adapters](nothen.com.ar/en/support-for-displaylink-adapters-on-linux/)
- [github: hadess: displaylink-rpm](https://github.com/hadess/displaylink-rpm) RPM sources for the DisplayLink USB display adapters

- download and unzip driver, and allow execute `.run` script

#### Fedora 23

- install using `rpm` as described at nothen.com.ar
- run `systemctl start displaylink.service` and plug in monitor

#### Ubuntu 14.04. (Kernel version 4.2.0-27-generic)

blacklist `udl`
:   `$ sudo su`, `$ echo en "blacklist udl\n" >> /etc/modprobe.d/blacklist-udl.conf`

screen should show after install driver
:   `$ sudo ~/Downloads/displaylink-driver-1.0.335.run`

uninstall driver before shutdown - or deactivate DLM upstart job and start manually `sudo start displaylink`

## Configuration

### Copy partition from Toshiba Z930: GParted

#### Source partition

partition
:   /dev/sda6

file system
:   `ext4`

label
:   `_Fedora-17-x86_6`

size
:   `48.83 GiB`

used
:   `35.49 GiB`

unused
:   `13.34 GiB`

#### Prepare transfer medium (LaCie Rugged)

- unmount partition
- resize (shrink) existing partition to 13310 MiB (> 48.83 GiB), thus creating an free/unallocated space after

### GParted USB

- copy partition `_Fedora-17-x86_6`
- paste to unallocated space on transfer medium

## Install OS

enter BIOS
:   `F2`

#### UEFI Boot Menu

`Settings` - `General` - `Boot Sequence`
:   Boot Option Name: ubuntu  
    File System List: HD(1.GPT.6E494141-8FDC-4390-9334-F837C1DF957A)  
    File Name: \EFI\ubuntu\shimx64.efi (other files: `grubx64.efi`, `MokManager.efi`, `grub.cfg`)

`Settings` - `General` - `Advanced Boot Options`
:   Enable Legacy Option ROMs: `TRUE` (contrary to http://www.dell.com/support/article/us/en/04/SLN297060/EN)
    Enable UEFI Network Stack: `FALSE`

#### UEFI and Fedora

- [Fedora Documentation: UEFI Secure Boot Guide](http://docs.fedoraproject.org/en-US/Fedora/18/html-single/UEFI_Secure_Boot_Guide/)

#### Copy Fedora `EFI/BOOT` files

- download Fedora image
- install Fedora LiveUSB Creator `sudo dnf install liveusb-creator`
- create bootable USB partition
- boot from USB
- follow instructions at http://www.dell.com/support/article/us/en/04/SLN297060/EN

```bash
$ sudo –s
# mkdir /dc
# mount /dev/sda1 /dc
# mkdir /dc/EFI/BOOT
# cp /cdrom/EFI/BOOT/* /dc/EFI/BOOT
# cd /
# umount /dc
# reboot$ sudo –s
# mkdir /dc
# mount /dev/sda1 /dc
# mkdir /dc/EFI/BOOT
# cp /cdrom/EFI/BOOT/* /dc/EFI/BOOT
# cd /
# umount /dc
# reboot
```

## Specifications

Processor
:   5th Generation Intel® Core™ i5-5200U Processor (3M Cache, up to 2.7GHz)

Operating System
:   Ubuntu Linux 14.04

Memory
:   8GB Dual Channel DDR3L-RS 1600Mhz (On Board)

Hard Drive
:   New 128GB SSD

Graphics Card
:   Intel (R) HD Graphics 5500

Display
:   13.3-inch FHD (1920 x 1080) InfinityEdge Display

Battery Life
:   Up to 15 hours of battery life

Warranty
:   1 Year ProSupport with Next Business Day Onsite Service

Ports
:   USB 3.0 w/Powershare (2)  
	Mini DisplayPort (1)  
	Headset jack (1)  
	Noblelock (1)  
	3-in-1 Card Reader (SD, SDHC, SDXC)

Chassis
:   **Exterior Chassis Materials**  
	CNC machined aluminum  
	Edge-to-edge Corning® Gorilla® Glass NBT™ on QHD+  
	Carbon fiber composite palm rest with soft touch paint  
	**Keyboard**  
	Full size, backlit chiclet keyboard; 1.3mm travel  
	**Touchpad**  
	Precision touchpad, seamless glass integrated button  

Ports, Slots & Chassis
:   USB 3.0 w/Powershare (2), mini DisplayPort (1), headset jack (1), Noblelock (1), 3-in-1 Card Reader (SD, SDHC, SDXC)

Dimensions & Weight
:   Height: 0.33-0.6" (9-15mm) / Width: 11.98" (304mm) / Depth: 7.88" (200mm)2.6lbs (1.18kg), 2.8lbs (1.26kg) for touch

Wireless
:   802.11ac + Bluetooth 4.0, Dual Band 2.4&5 GHz, 2x2

Primary Battery
:   52 WHr, 4-Cell Battery (integrated)

Power
:   47WHr battery; 6-Cell Li-Polymer (Battery is built-in to the laptop and is not replaceable by the customer.)

AC Adaptor
:   45W AC adapter
